@let planValue = plan.value();
@let me = profile.value();
@let creator = (planValue && planValue.user.id) === (me && me.id);
@if (!plan.isLoading() && planValue) {
  <div class="p-[15px]">
    <div
      class="bg-[linear-gradient(117deg,rgba(250,112,154,0.13)_0%,rgba(254,225,64,0.13)_100%)] rounded-[20px] p-[30px] text-center"
    >
      <h1 class="text-[60px] leading-[100%]">{{ planValue.emoji }}</h1>
      <div class="mt-[21px]">
        <h2 class="text-gray-900 text-2xl leading-[120%] font-bold mb-[10px]">
          {{ planValue.name }}
        </h2>
        <p class="text-gray-500 text-base font-normal leading-[100%]">
          {{ planValue.datetime | day: 'long' }}
        </p>
      </div>
    </div>
    <div class="space-y-[25px] mt-[30px]">
      <div>
        <b class="text-lg text-gray-900 block">Подробности</b>
        <div class="p-[15px] rounded-xl bg-gray-100 flex items-start gap-x-[15px] my-[10px]">
          <img
            src="imgs/location.png"
            alt="location.png"
            fetchpriority="high"
            loading="eager"
            width="22"
            height="23"
          />
          <div>
            <p class="text-gray-500 text-sm font-normal leading-[100%]">Место</p>
            <b class="font-bold text-gray-900 leading-[120%] text-base block mt-[5px]">{{
              planValue.location
            }}</b>
          </div>
        </div>
        <div class="p-[15px] rounded-xl bg-gray-100 flex items-start gap-x-[15px]">
          <img
            src="imgs/time.png"
            alt="time.png"
            fetchpriority="high"
            loading="eager"
            width="22"
            height="23"
          />
          <div>
            <p class="text-gray-500 text-sm font-normal leading-[100%]">Время</p>
            <b class="font-bold text-gray-900 leading-[120%] text-base block mt-[5px]">{{
              planValue.datetime | date: 'HH:mm'
            }}</b>
          </div>
        </div>
      </div>
      <div>
        <div class="flex items-center justify-between">
          <b class="text-lg text-gray-900 block">Участники ({{ planValue.user_plan_number }})</b>
          @if (creator) {
            <button
              type="button"
              class="bg-gray-100 rounded-xl w-[40px] h-[40px] content-center cursor-pointer"
              (click)="sharePlan()"
            >
              <img
                src=" imgs/plus.png"
                alt="plus.png"
                fetchpriority="high"
                loading="eager"
                width="19"
                height="19"
                class="block mx-auto"
              />
            </button>
          }
        </div>
        @if (planValue.plan_users.length) {
          @for (item of planValue.plan_users; track item.id) {
            <div
              class="p-[10px] rounded-xl bg-gray-100 flex items-center justify-between gap-x-[15px] my-[15px_10px]"
            >
              <div class="flex items-center gap-x-[12px]">
                <img
                  [src]="item.user.avatar"
                  alt="user.png"
                  class="block rounded-full"
                  fetchpriority="low"
                  loading="lazy"
                  width="40"
                  height="40"
                />
                @if (creator) {
                  <h1 class="text-base leading-[100%] text-gray-900 font-bold">Ты (организатор)</h1>
                } @else {
                  <h1 class="text-base leading-[100%] text-gray-900 font-bold">
                    {{ item.user.first_name }} {{ item.user.last_name }}
                  </h1>
                }
              </div>
              @switch (item.status) {
                @case ('Принято') {
                  <div class="text-xl font-900 leading-[100%]">✅</div>
                }
                @case ('Ожидает ответа') {
                  <div class="text-xl font-900 leading-[100%]">❓</div>
                }
              }
            </div>
          }
        }
      </div>
      @if (!creator && pending) {
        <div class="flex mb-3 items-stretch gap-x-[10px]">
          <button (click)="approve()"
            type="button"
            class="cursor-pointer flex-1 bg-green-400 rounded-full h-[52px] text-base font-bold text-white leading-[100%] flex items-center justify-center gap-x-[5px]"
          >
            ✔ Одобрить
          </button>
          <button (click)="reject()"
            type="button"
            class="cursor-pointer flex-1 bg-red-400 rounded-full h-[52px] text-base font-bold text-white leading-[100%] flex items-center justify-center gap-x-[5px]"
          >
            ❌ Отклонить
          </button>
        </div>
      }
      <div class="flex items-stretch gap-x-[10px]">
        <button
          [routerLink]="['/chats', id().toString()]"
          type="button"
          class="cursor-pointer flex-1 bg-[linear-gradient(106deg,#FA709A_0%,#FEE140_100%)] rounded-full h-[52px] text-base font-bold text-white leading-[100%] flex items-center justify-center gap-x-[5px]"
        >
          <img
            src="imgs/chat.png"
            alt="chat.png"
            fetchpriority="high"
            loading="eager"
            width="20"
            height="20"
          />
          Чат
        </button>
        @if (creator) {
          <button
            [routerLink]="['/update-plan', id().toString()]"
            type="button"
            class="cursor-pointer flex-1 bg-[linear-gradient(106deg,#F093FB_0%,#F5576C_100%)] rounded-full h-[52px] text-base font-bold text-white leading-[100%] flex items-center justify-center gap-x-[5px]"
          >
            <img
              src="imgs/pen.png"
              alt="pen.png"
              fetchpriority="high"
              loading="eager"
              width="19"
              height="19"
            />
            Изменить
          </button>
        }
      </div>
    </div>
  </div>
}
